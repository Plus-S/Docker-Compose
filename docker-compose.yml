version: '3'
services:

  https-portal:
    image: steveltn/https-portal:1
    ports:
      - '80:80'
      - '443:443'
    links:
      - plus-s-api
    restart: always
    environment:
      DOMAINS: 'api.plus-s.com.ar -> http://plus-s-api:8000'
      #STAGE: 'production' # Don't use production until staging works
      FORCE_RENEW: 'true'

  plus-s-api:
    image: ghcr.io/plus-s/back-end-prod:latest
    command: python manage.py runserver plus-s-api:8000
    ports:
      - "8000:8000"
    environment:
      - POSTGRES_NAME=${PROD_DB_NAME}
      - POSTGRES_USER=${PROD_DB_USER}
      - POSTGRES_PASSWORD=${PROD_DB_PASSWORD}
      - POSTGRES_HOST=${PROD_DB_HOST}

  dozzle:
    container_name: dozzle
    image: amir20/dozzle:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - 8080:8080
    environment:
      DOZZLE_LEVEL: trace
    healthcheck:
      test: [ "CMD", "/dozzle", "healthcheck" ]
      interval: 3s
      timeout: 30s
      retries: 5
      start_period: 30s
      
  pgadmin:
    container_name: pgadmin4_container
    image: dpage/pgadmin4
    restart: always
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@admin.com
      PGADMIN_DEFAULT_PASSWORD: root
    ports:
      - "5050:80"
